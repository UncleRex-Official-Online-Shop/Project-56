<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Uncle Rex ‚Äì Full Upgrade</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { margin: 0; font-family: 'Montserrat', sans-serif; background: #f5f5f5; }
    header { background: #000; color: #fff; padding: 1rem 2rem; text-align: center; display: none; }
    .nav-tabs { display: none; background: #fff; border-bottom: 1px solid #ddd; justify-content: space-around; padding: 0.5rem 0; }
    .nav-tabs a { color: #333; text-decoration: none; font-weight: bold; display: flex; flex-direction: column; align-items: center; font-size: 0.9rem; }
    .nav-tabs a i { font-size: 1.3rem; margin-bottom: 0.3rem; }
    .section { display: none; padding: 2rem; }
    .products, .reviews { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
    .card { background: #fff; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .card img { width: 100%; border-radius: 8px; }
    .btn { background: gold; border: none; padding: 0.7rem 1.5rem; margin-top: 1rem; border-radius: 5px; font-weight: bold; cursor: pointer; }
    input, textarea { width: 100%; padding: 0.7rem; margin-top: 0.8rem; border: 1px solid #ccc; border-radius: 5px; }
    #welcome-screen, #visitor-info { text-align: center; padding: 3rem 1rem; }
    footer { background: #000; color: #bbb; text-align: center; padding: 1rem; font-size: 0.9rem; margin-top: 2rem; }
  </style>
</head>
<body>

<div id="welcome-screen">
  <h1>Welcome to Uncle Rex Store</h1>
  <p>Creative CVs, love letters, posters, and more</p>
  <button class="btn" onclick="proceedToVisitor()">Proceed</button>
</div>

<div id="visitor-info" style="display:none;">
  <h2>Enter Your Details</h2>
  <input type="text" id="visitor-name" placeholder="Full Name" required />
  <input type="text" id="visitor-whatsapp" placeholder="WhatsApp Number" required />
  <input type="text" id="visitor-phone" placeholder="Phone Number" required />
  <button class="btn" onclick="saveVisitor()">Continue to Store</button>
</div>

<header>
  <h1>Uncle Rex</h1>
</header>

<nav class="nav-tabs">
  <a href="#" onclick="showSection('products')"><i class="fas fa-home"></i>Home</a>
  <a href="#" onclick="showSection('contact')"><i class="fas fa-envelope"></i>Contact</a>
  <a href="#" onclick="showSection('admin-login')"><i class="fas fa-wrench"></i>Fix</a>
  <a href="#" onclick="showSection('reviews')"><i class="fas fa-star"></i>Reviews</a>
</nav>

<section id="products" class="section products"></section>

<section id="contact" class="section">
  <h2>Contact Us</h2>
  <form id="contact-form">
    <input type="text" name="name" placeholder="Your Name" required />
    <input type="email" name="email" placeholder="Your Email" required />
    <textarea name="message" placeholder="Your Message" required></textarea>
    <button type="submit" class="btn">Send</button>
  </form>
</section>

<section id="admin-login" class="section">
  <h2>Admin Login</h2>
  <input type="email" id="admin-email" placeholder="Email" />
  <input type="password" id="admin-password" placeholder="Password" />
  <button class="btn" onclick="loginAdmin()">Login</button>
</section>

<section id="admin" class="section" style="display:none;">
  <h2>Upload Product</h2>
  <form id="upload-form">
    <input type="text" id="product-title" placeholder="Title" required />
    <input type="text" id="product-description" placeholder="Description" required />
    <input type="file" id="product-image" accept="image/*" required />
    <button class="btn" type="submit">Upload</button>
  </form>
</section>

<section id="reviews" class="section reviews"></section>

<footer>&copy; 2025 Uncle Rex Store. All rights reserved.</footer>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
  import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
  import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';

  const firebaseConfig = {
    apiKey: "AIzaSyCqgOab9u1bb5yqDBC9iQNZkBJrl0hUSPY",
    authDomain: "unclerexstore.firebaseapp.com",
    projectId: "unclerexstore",
    storageBucket: "unclerexstore.firebasestorage.app",
    messagingSenderId: "76853926066",
    appId: "1:76853926066:web:97ce9dc0eab990907151ab"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  async function loadProducts() {
    const container = document.getElementById('products');
    container.innerHTML = '';
    const snapshot = await getDocs(collection(db, 'products'));
    snapshot.forEach(doc => {
      const p = doc.data();
      const html = `<div class="card">
        <img src="${p.image}" alt="${p.title}"/>
        <h3>${p.title}</h3>
        <p>${p.description}</p>
        <button class="btn">Order</button>
      </div>`;
      container.insertAdjacentHTML('beforeend', html);
    });
  }

  async function loadReviews() {
    const container = document.getElementById('reviews');
    container.innerHTML = '';
    const snapshot = await getDocs(collection(db, 'reviews'));
    snapshot.forEach(doc => {
      const r = doc.data();
      const html = `<div class="card">
        <p>${r.text}</p>
        ${r.image ? `<img src="${r.image}" />` : ""}
        <button class="btn">üëç</button> <button class="btn">üëé</button>
        <textarea placeholder="Write a comment..."></textarea>
        <button class="btn">Comment</button>
      </div>`;
      container.insertAdjacentHTML('beforeend', html);
    });
  }

  loadProducts();
  loadReviews();

  document.getElementById('contact-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = e.target.name.value;
    const email = e.target.email.value;
    const message = e.target.message.value;
    await addDoc(collection(db, 'messages'), { name, email, message, timestamp: serverTimestamp() });
    alert('Message sent');
    e.target.reset();
  });

  document.getElementById('upload-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const title = document.getElementById('product-title').value;
    const description = document.getElementById('product-description').value;
    const file = document.getElementById('product-image').files[0];

    const IMGBB_API_KEY = "94515aeb59eb9ab03d29ddb6a764169a";
    const formData = new FormData();
    formData.append('image', file);

    const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
    const result = await res.json();
    const imageUrl = result.data.url;

    await addDoc(collection(db, 'products'), { title, description, image: imageUrl });
    alert('Product uploaded!');
    e.target.reset();
    loadProducts();
  });

  window.loginAdmin = async () => {
    const email = document.getElementById('admin-email').value;
    const pass = document.getElementById('admin-password').value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      document.getElementById('admin').style.display = 'block';
      alert('Admin access granted.');
    } catch {
      alert('Login failed.');
    }
  };

  window.proceedToVisitor = () => {
    document.getElementById('welcome-screen').style.display = 'none';
    document.getElementById('visitor-info').style.display = 'block';
  };

  window.saveVisitor = async () => {
    const name = document.getElementById('visitor-name').value;
    const phone = document.getElementById('visitor-phone').value;
    const whatsapp = document.getElementById('visitor-whatsapp').value;

    if (name && phone && whatsapp) {
      await addDoc(collection(db, 'visitors'), { name, phone, whatsapp, timestamp: serverTimestamp() });
      document.querySelector('header').style.display = 'block';
      document.querySelector('.nav-tabs').style.display = 'flex';
      document.getElementById('visitor-info').style.display = 'none';
      showSection('products');
    } else {
      alert('Please fill in all fields');
    }
  };

  window.showSection = (id) => {
    document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
    document.getElementById(id).style.display = 'block';
  };
</script>
</body>
</html>
